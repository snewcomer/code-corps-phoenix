defmodule CodeCorps.Validators.SlugValidator do
  def validate_slug(changeset, field_name) do
    valid_slug_pattern = ~r/\A((?:(?:(?:[^-\W]-?))*)(?:(?:(?:[^-\W]-?))*)\w+)\z/
    reserved_routes = ~w(
      about account admin android api app apps blog bug bugs cache charter
      comment comments contact contributor contributors cookies
      developer developers discover donate engineering enterprise explore
      facebook favorites feed followers following github help home image images
      integration integrations invite invitations ios issue issues jobs learn
      likes lists log-in log-out login logout mention mentions new news
      notification notifications oauth oauth_clients organization organizations
      ping popular post_image post_images post_like post_likes post post
      press pricing privacy
      project projects repositories role roles rules search security session
      sessions settings shop showcases sidekiq sign-in sign-out signin signout
      signup sitemap slug slugs spotlight stars status tag tags
      tasks team teams terms training trends trust tour twitter
      user_role user_roles user_skill user_skills user users watching year
    )

    changeset
    |> Ecto.Changeset.validate_format(field_name, valid_slug_pattern)
    |> Ecto.Changeset.validate_exclusion(field_name, reserved_routes)
  end
end
